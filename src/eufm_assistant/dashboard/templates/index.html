<!DOCTYPE html>
<html lang="en">
<head><meta charset="UTF-8"><title>EUFM Assistant Dashboard</title><link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}"></head>
<body>
    <div class="container">
        <nav><a href="/">Home</a><a href="/research">Research</a><a href="/strategy">Strategy</a></nav>
        <h1>EUFM Assistant Dashboard</h1>
        <div class="compliance-score">Compliance Score: <span class="score {% if compliance_score > 80 %}status-green{% elif compliance_score > 50 %}status-yellow{% else %}status-red{% endif %}">{{ compliance_score }}%</span></div>
        <h2>Work Breakdown Structure (WBS)</h2>
        <table>
            <thead><tr><th>ID</th><th>Title</th><th>Status</th></tr></thead>
            <tbody>
                {% for wp in wbs_data.work_packages %}
                <tr class="status-{{ wp.status | lower }}"><td class="wbs-id">{{ wp.id }}</td><td>{{ wp.title }}</td><td>{{ wp.status }}</td></tr>
                {% endfor %}
            </tbody>
        </table>

        <h2>Project Timeline</h2>
        <div id="timeline"></div>
    </div>

    <script>
    fetch('/api/timeline')
        .then(response => response.json())
        .then(data => {
            const timelineContainer = document.getElementById('timeline');
            if (data.length === 0) {
                timelineContainer.innerHTML = '<p>No timeline events found.</p>';
                return;
            }

            const timelineEl = document.createElement('div');
            timelineEl.className = 'timeline-container';

            data.forEach(event => {
                const eventEl = document.createElement('div');
                eventEl.className = 'timeline-event';
                eventEl.innerHTML = `
                    <div class="timeline-date">${event.due}</div>
                    <div class="timeline-content">
                        <h4>${event.title} (${event.wp})</h4>
                        <p><strong>Type:</strong> ${event.type} | <strong>Owner:</strong> ${event.owner}</p>
                    </div>
                `;
                timelineEl.appendChild(eventEl);
            });

            timelineContainer.appendChild(timelineEl);
        })
        .catch(error => {
            console.error('Error fetching timeline data:', error);
            const timelineContainer = document.getElementById('timeline');
            timelineContainer.innerHTML = '<p>Could not load timeline data.</p>';
        });
    </script>
</body>
</html>
